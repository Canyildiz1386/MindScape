<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <link rel="shortcut icon" type="x-icon" href="{{ url_for('static', filename='images/mind_9548035.png') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>نتیجه آزمون آخنباخ</title>
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
        crossorigin="anonymous"
    />
    <script
        src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"
    ></script>
    <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
        integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
        crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/quiz.css') }}" />
    <style>
        body {
            direction: rtl;
        }

        @font-face {
            font-family: "Anjomanweb VF";
            src: url("{{ url_for('static', filename='src/AnjomanwebGX.woff') }}") format("woff-variations"),
                 url("{{ url_for('static', filename='src/AnjomanwebGX.woff') }}") format("woff");
            font-display: fallback;
        }

        * {
            font-family: "Anjomanweb VF";
        }
    </style>
</head>
<body>
    <div class="container py-3 rounded-4 shadow my-4">
        <div class="container">
            <div class="p-3 mb-4">
                <h3 class="fs-3 text-center">نتیجه آزمون آخنباخ</h3>
                <div class="mt-3">
                    <p class="p-2">
                        <span>نتایج آزمون بر اساس پاسخ‌های شما به شرح زیر است:</span>
                    </p>
                </div>
    
                <!-- Display the result message -->
                <div class="my-4">
                    <p>{{ result_message | safe }}</p>
                </div>
    
                <!-- Display the responsive plot -->
                <div class="text-center">
                  <h4>نمودار نمرات آزمون</h4>
                  <img src="{{ plot_url }}" alt="Akhenbach Test Plot" class="img-fluid rounded">
              </div>
            </div>
    
            <!-- Back to user panel button -->
            <div class="d-grid">
                <a href="{{ url_for('user_panel') }}" class="btn btn-secondary">بازگشت به صفحه کاربری</a>
            </div>
        </div>
    </div>

    <!-- Additional Scripts -->
    <script>
        let hide = document.querySelector("#start");
        
        function hidebutt() {
          hide.className = "hidden";
        }
        
        $(document).ready(function() {
          var minDate = [1387, 1, 1];
          var maxDate = [1399, 12, 29];
    
          $("#date").pDatepicker({
            format: 'YYYY/MM/DD',
            minDate: minDate,
            maxDate: maxDate,
          });
        });
      </script>
      <script>
        function showLoadingOverlay() {
          const overlay = document.getElementById('loading-overlay');
          overlay.style.opacity = '1'; 
          overlay.style.visibility = 'visible';
        }
      
        function hideLoadingOverlay() {
          const overlay = document.getElementById('loading-overlay');
          overlay.classList.add('fade-out');
      
          setTimeout(() => {
            overlay.style.display = 'none';
          }, 500);
        }
      
        function setLTRLayout() {
          document.body.style.direction = 'ltr'; 
          document.body.style.textAlign = 'left';
        }
      
        async function translatePage(language) {
          const elements = document.querySelectorAll("h1,title, h2, h3, h4, p, button, a, span, input, textarea");
          showLoadingOverlay();
  
          for (let element of elements) {
            if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
              continue;
            }

            let childNodes = Array.from(element.childNodes);

            for (let child of childNodes) {
              if (child.nodeType === Node.TEXT_NODE) {
                let text = child.textContent.trim();

                if (text) {
                  const cachedTranslation = localStorage.getItem(`${language}-${text}`);

                  if (cachedTranslation) {
                    child.textContent = cachedTranslation;
                  } else {
                    try {
                      const response = await fetch("/translate", {
                        method: "POST",
                        headers: {
                          "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                          text: text,
                          target_language: language,
                        }),
                      });

                      const result = await response.json();

                      if (response.ok) {
                        child.textContent = result.translated_text;
                        localStorage.setItem(`${language}-${text}`, result.translated_text);
                      }
                    } catch (error) {
                      console.error("Error translating text:", error);
                    }
                  }
                }
              }
            }
          }

          setLTRLayout(); 
          hideLoadingOverlay();
        }
  
        function checkLanguageInSlug() {
          const urlParams = new URLSearchParams(window.location.search);
          if (urlParams.has('lang')) {
            const language = urlParams.get('lang');
            translatePage(language);
          } else {
            hideLoadingOverlay();
          }
        }
      
        window.onload = checkLanguageInSlug;
      </script>
      
      <style>
        #loading-overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: white;
          z-index: 9999;
          display: flex;
          justify-content: center;
          align-items: center;
          opacity: 1;
          transition: opacity 0.5s ease;
        }
      
        #loading-spinner {
          position: absolute;
        }
      
        .fade-out {
          opacity: 0;
          visibility: hidden;
        }
      </style>
  
  <div id="loading-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: white; z-index: 9999;">
    <div id="loading-spinner" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  </div>
</body>
</html>
